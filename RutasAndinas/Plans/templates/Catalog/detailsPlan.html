{% block content %}
<div class="container mt-4">
    <h2>Detalles del Plan</h2>
    
    <div class="mb-3">
        <strong>Nombre del Plan:</strong> {{ plan.name }}
    </div>

    <div class="mb-3">
        <div>
            {% for picture in pictures %}
                <img src="{{ picture.picture.url }}" alt="Imagen del Plan" width="150" class="me-2">
            {% empty %}
                <p>No hay imágenes disponibles.</p>
            {% endfor %}
        </div>
    </div>

    <div class="mb-3">
        <strong>Descripción:</strong>
        <p>{{ plan.description }}</p>
    </div>

    <div class="mb-3">
        <strong>Precio:</strong> ${{ plan.price }}
    </div>

    <div class="mb-3">
        <strong>Categoría:</strong> {{ plan.category_id.category }}
    </div>

    <div class="mb-3">
        <strong>Incluye:</strong>
        <ul>
            <li>Transporte: {% if plan.has_transport %} Sí {% else %} No {% endif %}</li>
            <li>Alimentación: {% if plan.has_meal %} Sí {% else %} No {% endif %}</li>
            <li>Guía: {% if plan.has_guide %} Sí {% else %} No {% endif %}</li>
        </ul>
    </div>

    <div class="mb-3">
        <strong>Fechas Disponibles:</strong>
        <ul>
            {% for date_obj in plan_dates %}
                <li>{{ date_obj.plan_date|date:'Y-m-d' }}</li>  
            {% empty %}
                <li>No hay fechas disponibles</li>
            {% endfor %}
        </ul>
    </div>

    <div class="mb-3">
        <h4>Reseñas</h4>
        {% if reviews %}
            {% for review in reviews %}
                <div class="border p-2 mb-2">
                    <p><strong>{{ review.user_id.username }}</strong></p>
                    <h3>
                        <span class="star-rating stary">
                            {% for i in "12345" %}
                                {% if i <= review.rate|stringformat:"s" %}
                                    &#9733;
                                {% else %}
                                    &#9734;
                                {% endif %}
                            {% endfor %}
                        </span>
                        ({{ review.rate }}/5)
                    </h3>
                    <p>{{ review.content }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p>No hay reseñas para este plan.</p>
        {% endif %}
    </div>

    <div class="mt-4">
        <h4>Escribe tu reseña</h4>
        <form method="POST" action="{% url 'reviews:create_review' plan.plan_id %}">
            {% csrf_token %}
            <div class="mb-3">
                <label for="rate" class="form-label">Calificación:</label>
                <div id="star-container" class="mb-2">
                    {% for i in "12345" %}
                        <span class="star" data-value="{{ i }}">&#9734;</span>
                    {% endfor %}
                </div>
                <input type="hidden" id="rate" name="rate" value="0" required>
            </div>
            <div class="mb-3">
                <label for="content" class="form-label">Comentario:</label>
                <textarea id="content" name="content" rows="3" class="form-control" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Enviar Reseña</button>
        </form>
    </div>

        <a href="{% url 'catalog' %}" class="btn btn-secondary">Volver al catálogo</a>
</div>
<script>
    const stars = document.querySelectorAll('.star');
    const rateInput = document.getElementById('rate');

    stars.forEach((star, index) => {
        star.addEventListener('click', () => {
            // Actualiza el valor del input oculto
            rateInput.value = index + 1;
            // Resetea las estrellas
            stars.forEach((s, i) => {
                s.innerHTML = i <= index ? '&#9733;' : '&#9734;';
            });
        });
    });
</script>

<style>
    .stary {
        font-size: 2rem;
        color: #ffc107;
    }
    .star {
        font-size: 2rem;
        cursor: pointer;
        color: #ffc107;
    }
    .star:hover {
        transform: scale(1.2);
    }
</style>
{% endblock %}
