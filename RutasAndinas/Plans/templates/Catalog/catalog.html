{% block content %}
<div class="container mt-4">
    <h2>Catálogo</h2>

    <!-- Filtro por Categoría -->
    <form method="GET">
        <label for="category">Filtrar por categoría:</label>
        <select name="category_id" id="category" onchange="this.form.submit()">
            <option value="">Todas las Categorias</option>
            {% for category in categories %}
            {% if request.GET.category_id|stringformat:"s" == category.category_id|stringformat:"s" %}
                <option value="{{ category.category_id }}" selected>
            {% else %}
                <option value="{{ category.category_id }}">
            {% endif %}
                {{ category.category }}
            </option>
        {% endfor %}
        </select>
    </form>
    <ul>
        {% for item in plans_with_avg %}
            <li>
                <h2>{{ item.plan.name }}</h2>
                <!-- Mostrar imágenes asociadas al plan -->
                {% with item.plan.picture_set.all as pictures %}
                    {% if pictures %}
                        {% for picture in pictures %}
                            <img src="{{ picture.picture.url }}" alt="Plan Image" width="200">
                        {% endfor %}
                    {% else %}
                        <p>No images available.</p>
                    {% endif %}
                {% endwith %}
                
                <h3> 
                    <span class="star-rating star">
                        {% for i in "12345" %}
                            {% if i <= item.avg_rating|stringformat:"s" %}
                                &#9733;
                            {% else %}
                                &#9734;
                            {% endif %}
                        {% endfor %}
                    </span>
                    ({{ item.avg_rating }}/5)
                </h3>
                
                <p><strong>Categoria:</strong> {{ item.plan.category_id.category }}</p>
                <p><strong>Precio:</strong> ${{ item.plan.price }}</p>
                <a href="{% url 'detailsPlan' item.plan.plan_id %}">
                    <button>Más información</button>
                </a>           
            </li>
        {% empty %}
            <p>No plans available.</p>
        {% endfor %}
    </ul>

    <style>
        .star {
            font-size: 2rem;
            color: #ffc107;
        }
    </style>
{% endblock %}
